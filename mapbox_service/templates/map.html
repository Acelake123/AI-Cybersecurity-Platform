
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Threat Map</title>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
<style> body { margin:0; padding:0; } #map { position:absolute; top:0; bottom:0; width:100%; }</style>
</head>
<body>
<div id="map"></div>
<script>
mapboxgl.accessToken = "{{ mapbox_key }}";
const map = new mapboxgl.Map({ container: 'map', style: 'mapbox://styles/mapbox/streets-v12', center: [0,20], zoom: 1.5 });
async function loadAlerts(){
  const res = await fetch('/data/alerts');
  const alerts = await res.json();
  alerts.forEach(a=>{
    try{
      const coords = [ (Math.random()-0.5)*360, (Math.random()-0.5)*180 ];
      const el = document.createElement('div');
      el.style.width='10px'; el.style.height='10px'; el.style.background='red'; el.style.borderRadius='50%';
      new mapboxgl.Marker(el).setLngLat(coords).setPopup(new mapboxgl.Popup().setText(`ID:${a.id} ${a.src_ip} -> ${a.dst_ip}`)).addTo(map);
    }catch(e){}
  });
}
map.on('load', loadAlerts);
setInterval(loadAlerts, 7000);
</script>
</body>
</html>
